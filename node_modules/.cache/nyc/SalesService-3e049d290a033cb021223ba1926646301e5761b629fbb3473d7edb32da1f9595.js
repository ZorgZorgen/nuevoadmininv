function cov_1dpflqbju5(){var path="/Volumes/F'sinthecha/Github/store-manager/services/SalesService.js";var hash="10e4c9e35075925aa94905f3f58a468e5d109545";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Volumes/F'sinthecha/Github/store-manager/services/SalesService.js",statementMap:{"0":{start:{line:1,column:19},end:{line:1,column:50}},"1":{start:{line:2,column:22},end:{line:2,column:56}},"2":{start:{line:3,column:25},end:{line:3,column:57}},"3":{start:{line:4,column:28},end:{line:4,column:63}},"4":{start:{line:5,column:28},end:{line:5,column:63}},"5":{start:{line:7,column:15},end:{line:21,column:1}},"6":{start:{line:8,column:17},end:{line:8,column:42}},"7":{start:{line:10,column:2},end:{line:15,column:3}},"8":{start:{line:11,column:4},end:{line:14,column:6}},"9":{start:{line:17,column:2},end:{line:20,column:4}},"10":{start:{line:23,column:16},end:{line:37,column:1}},"11":{start:{line:24,column:17},end:{line:24,column:45}},"12":{start:{line:26,column:2},end:{line:31,column:3}},"13":{start:{line:27,column:4},end:{line:30,column:6}},"14":{start:{line:33,column:2},end:{line:36,column:4}},"15":{start:{line:39,column:15},end:{line:62,column:1}},"16":{start:{line:44,column:52},end:{line:44,column:80}},"17":{start:{line:46,column:2},end:{line:48,column:3}},"18":{start:{line:47,column:4},end:{line:47,column:64}},"19":{start:{line:50,column:17},end:{line:50,column:46}},"20":{start:{line:52,column:2},end:{line:59,column:4}},"21":{start:{line:54,column:26},end:{line:54,column:61}},"22":{start:{line:56,column:6},end:{line:56,column:79}},"23":{start:{line:57,column:6},end:{line:57,column:76}},"24":{start:{line:61,column:2},end:{line:61,column:63}},"25":{start:{line:64,column:15},end:{line:84,column:1}},"26":{start:{line:65,column:16},end:{line:65,column:71}},"27":{start:{line:67,column:2},end:{line:67,column:62}},"28":{start:{line:67,column:14},end:{line:67,column:62}},"29":{start:{line:69,column:23},end:{line:69,column:74}},"30":{start:{line:71,column:2},end:{line:71,column:94}},"31":{start:{line:71,column:28},end:{line:71,column:94}},"32":{start:{line:73,column:2},end:{line:73,column:88}},"33":{start:{line:75,column:17},end:{line:75,column:69}},"34":{start:{line:77,column:2},end:{line:83,column:4}},"35":{start:{line:86,column:19},end:{line:105,column:1}},"36":{start:{line:87,column:23},end:{line:87,column:40}},"37":{start:{line:89,column:2},end:{line:89,column:48}},"38":{start:{line:89,column:28},end:{line:89,column:48}},"39":{start:{line:91,column:2},end:{line:91,column:40}},"40":{start:{line:93,column:17},end:{line:93,column:48}},"41":{start:{line:95,column:2},end:{line:100,column:3}},"42":{start:{line:96,column:4},end:{line:99,column:6}},"43":{start:{line:102,column:2},end:{line:104,column:4}},"44":{start:{line:107,column:0},end:{line:113,column:2}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:15},end:{line:7,column:16}},loc:{start:{line:7,column:27},end:{line:21,column:1}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:23,column:16},end:{line:23,column:17}},loc:{start:{line:23,column:30},end:{line:37,column:1}},line:23},"2":{name:"(anonymous_2)",decl:{start:{line:39,column:15},end:{line:39,column:16}},loc:{start:{line:39,column:32},end:{line:62,column:1}},line:39},"3":{name:"(anonymous_3)",decl:{start:{line:53,column:14},end:{line:53,column:15}},loc:{start:{line:53,column:56},end:{line:58,column:5}},line:53},"4":{name:"(anonymous_4)",decl:{start:{line:64,column:15},end:{line:64,column:16}},loc:{start:{line:64,column:54},end:{line:84,column:1}},line:64},"5":{name:"(anonymous_5)",decl:{start:{line:86,column:19},end:{line:86,column:20}},loc:{start:{line:86,column:33},end:{line:105,column:1}},line:86}},branchMap:{"0":{loc:{start:{line:10,column:2},end:{line:15,column:3}},type:"if",locations:[{start:{line:10,column:2},end:{line:15,column:3}},{start:{line:10,column:2},end:{line:15,column:3}}],line:10},"1":{loc:{start:{line:26,column:2},end:{line:31,column:3}},type:"if",locations:[{start:{line:26,column:2},end:{line:31,column:3}},{start:{line:26,column:2},end:{line:31,column:3}}],line:26},"2":{loc:{start:{line:46,column:2},end:{line:48,column:3}},type:"if",locations:[{start:{line:46,column:2},end:{line:48,column:3}},{start:{line:46,column:2},end:{line:48,column:3}}],line:46},"3":{loc:{start:{line:46,column:6},end:{line:46,column:51}},type:"binary-expr",locations:[{start:{line:46,column:6},end:{line:46,column:26}},{start:{line:46,column:30},end:{line:46,column:51}}],line:46},"4":{loc:{start:{line:47,column:11},end:{line:47,column:63}},type:"cond-expr",locations:[{start:{line:47,column:35},end:{line:47,column:48}},{start:{line:47,column:51},end:{line:47,column:63}}],line:47},"5":{loc:{start:{line:67,column:2},end:{line:67,column:62}},type:"if",locations:[{start:{line:67,column:2},end:{line:67,column:62}},{start:{line:67,column:2},end:{line:67,column:62}}],line:67},"6":{loc:{start:{line:71,column:2},end:{line:71,column:94}},type:"if",locations:[{start:{line:71,column:2},end:{line:71,column:94}},{start:{line:71,column:2},end:{line:71,column:94}}],line:71},"7":{loc:{start:{line:89,column:2},end:{line:89,column:48}},type:"if",locations:[{start:{line:89,column:2},end:{line:89,column:48}},{start:{line:89,column:2},end:{line:89,column:48}}],line:89},"8":{loc:{start:{line:95,column:2},end:{line:100,column:3}},type:"if",locations:[{start:{line:95,column:2},end:{line:100,column:3}},{start:{line:95,column:2},end:{line:100,column:3}}],line:95}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"10e4c9e35075925aa94905f3f58a468e5d109545"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1dpflqbju5=function(){return actualCoverage;};}return actualCoverage;}cov_1dpflqbju5();const SalesModel=(cov_1dpflqbju5().s[0]++,require('../models/SalesModel'));const ProductsModel=(cov_1dpflqbju5().s[1]++,require('../models/ProductsModel'));const{addInventory}=(cov_1dpflqbju5().s[2]++,require('../utils/addInventory'));const{validateProduct}=(cov_1dpflqbju5().s[3]++,require('../utils/validateProduct'));const{updateInventory}=(cov_1dpflqbju5().s[4]++,require('../utils/updateInventory'));cov_1dpflqbju5().s[5]++;const getAll=async()=>{cov_1dpflqbju5().f[0]++;const result=(cov_1dpflqbju5().s[6]++,await SalesModel.getAll());cov_1dpflqbju5().s[7]++;if(result.length===0){cov_1dpflqbju5().b[0][0]++;cov_1dpflqbju5().s[8]++;return{code:404,message:'Sales not found'};}else{cov_1dpflqbju5().b[0][1]++;}cov_1dpflqbju5().s[9]++;return{code:200,data:result};};cov_1dpflqbju5().s[10]++;const getById=async id=>{cov_1dpflqbju5().f[1]++;const result=(cov_1dpflqbju5().s[11]++,await SalesModel.getById(id));cov_1dpflqbju5().s[12]++;if(result.length===0){cov_1dpflqbju5().b[1][0]++;cov_1dpflqbju5().s[13]++;return{code:404,message:'Sale not found'};}else{cov_1dpflqbju5().b[1][1]++;}cov_1dpflqbju5().s[14]++;return{code:200,data:result};};cov_1dpflqbju5().s[15]++;const create=async sales=>{cov_1dpflqbju5().f[2]++;/* 
    Validate if the products in the "sales" array exists
    and if the inventory quantity subtractected sale quantity is greater than 0
  */const{productError,quantityError,products}=(cov_1dpflqbju5().s[16]++,await validateProduct(sales));cov_1dpflqbju5().s[17]++;if((cov_1dpflqbju5().b[3][0]++,productError.message)||(cov_1dpflqbju5().b[3][1]++,quantityError.message)){cov_1dpflqbju5().b[2][0]++;cov_1dpflqbju5().s[18]++;return quantityError.message?(cov_1dpflqbju5().b[4][0]++,quantityError):(cov_1dpflqbju5().b[4][1]++,productError);}else{cov_1dpflqbju5().b[2][1]++;}const saleId=(cov_1dpflqbju5().s[19]++,await SalesModel.createSale());cov_1dpflqbju5().s[20]++;await Promise.all(sales.map(async({productId,quantity},index)=>{cov_1dpflqbju5().f[3]++;const newQuantity=(cov_1dpflqbju5().s[21]++,products[index].quantity-quantity);cov_1dpflqbju5().s[22]++;await ProductsModel.updateQuantity({productId,quantity:newQuantity});cov_1dpflqbju5().s[23]++;await SalesModel.createSalesProducts({saleId,productId,quantity});}));cov_1dpflqbju5().s[24]++;return{code:201,data:{id:saleId,itemsSold:sales}};};cov_1dpflqbju5().s[25]++;const update=async({id,productId,quantity})=>{cov_1dpflqbju5().f[4]++;const sales=(cov_1dpflqbju5().s[26]++,await SalesModel.getByIdAndProductId({id,productId}));cov_1dpflqbju5().s[27]++;if(!sales){cov_1dpflqbju5().b[5][0]++;cov_1dpflqbju5().s[28]++;return{code:404,message:'Sale not found'};}else{cov_1dpflqbju5().b[5][1]++;}const updateResult=(cov_1dpflqbju5().s[29]++,await updateInventory(id,quantity,sales.quantity));cov_1dpflqbju5().s[30]++;if(updateResult.message){cov_1dpflqbju5().b[6][0]++;cov_1dpflqbju5().s[31]++;return{code:updateResult.code,message:updateResult.message};}else{cov_1dpflqbju5().b[6][1]++;}cov_1dpflqbju5().s[32]++;await ProductsModel.updateQuantity({productId,quantity:updateResult.newQuantity});const result=(cov_1dpflqbju5().s[33]++,await SalesModel.update({id,productId,quantity}));cov_1dpflqbju5().s[34]++;return{code:200,data:{saleId:id,itemUpdated:[result]}};};cov_1dpflqbju5().s[35]++;const deleteSale=async id=>{cov_1dpflqbju5().f[5]++;const getSalesById=(cov_1dpflqbju5().s[36]++,await getById(id));cov_1dpflqbju5().s[37]++;if(getSalesById.message){cov_1dpflqbju5().b[7][0]++;cov_1dpflqbju5().s[38]++;return getSalesById;}else{cov_1dpflqbju5().b[7][1]++;}cov_1dpflqbju5().s[39]++;await addInventory(getSalesById.data);const result=(cov_1dpflqbju5().s[40]++,await SalesModel.deleteSale(id));cov_1dpflqbju5().s[41]++;if(!result){cov_1dpflqbju5().b[8][0]++;cov_1dpflqbju5().s[42]++;return{code:404,message:'Sale not found'};}else{cov_1dpflqbju5().b[8][1]++;}cov_1dpflqbju5().s[43]++;return{code:204};};cov_1dpflqbju5().s[44]++;module.exports={getAll,getById,create,update,deleteSale};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNhbGVzU2VydmljZS5qcyJdLCJuYW1lcyI6WyJTYWxlc01vZGVsIiwicmVxdWlyZSIsIlByb2R1Y3RzTW9kZWwiLCJhZGRJbnZlbnRvcnkiLCJ2YWxpZGF0ZVByb2R1Y3QiLCJ1cGRhdGVJbnZlbnRvcnkiLCJnZXRBbGwiLCJyZXN1bHQiLCJsZW5ndGgiLCJjb2RlIiwibWVzc2FnZSIsImRhdGEiLCJnZXRCeUlkIiwiaWQiLCJjcmVhdGUiLCJzYWxlcyIsInByb2R1Y3RFcnJvciIsInF1YW50aXR5RXJyb3IiLCJwcm9kdWN0cyIsInNhbGVJZCIsImNyZWF0ZVNhbGUiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwicHJvZHVjdElkIiwicXVhbnRpdHkiLCJpbmRleCIsIm5ld1F1YW50aXR5IiwidXBkYXRlUXVhbnRpdHkiLCJjcmVhdGVTYWxlc1Byb2R1Y3RzIiwiaXRlbXNTb2xkIiwidXBkYXRlIiwiZ2V0QnlJZEFuZFByb2R1Y3RJZCIsInVwZGF0ZVJlc3VsdCIsIml0ZW1VcGRhdGVkIiwiZGVsZXRlU2FsZSIsImdldFNhbGVzQnlJZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI0aU1BZVk7MkZBZlosS0FBTUEsQ0FBQUEsVUFBVSwwQkFBR0MsT0FBTyxDQUFDLHNCQUFELENBQVYsQ0FBaEIsQ0FDQSxLQUFNQyxDQUFBQSxhQUFhLDBCQUFHRCxPQUFPLENBQUMseUJBQUQsQ0FBVixDQUFuQixDQUNBLEtBQU0sQ0FBRUUsWUFBRiwyQkFBbUJGLE9BQU8sQ0FBQyx1QkFBRCxDQUExQixDQUFOLENBQ0EsS0FBTSxDQUFFRyxlQUFGLDJCQUFzQkgsT0FBTyxDQUFDLDBCQUFELENBQTdCLENBQU4sQ0FDQSxLQUFNLENBQUVJLGVBQUYsMkJBQXNCSixPQUFPLENBQUMsMEJBQUQsQ0FBN0IsQ0FBTixDLHdCQUVBLEtBQU1LLENBQUFBLE1BQU0sQ0FBRyxTQUFZLHlCQUN6QixLQUFNQyxDQUFBQSxNQUFNLDBCQUFHLEtBQU1QLENBQUFBLFVBQVUsQ0FB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QUF0QixDQUFULENBQVosQ0FQK0IseUJBUy9CLEdBQUksQ0FBQ04sTUFBTCxDQUFhLHFEQUNYLE1BQU8sQ0FDTEUsSUFBSSxDQUFFLEdBREQsQ0FFTEMsT0FBTyxDQUFFLGdCQUZKLENBQVAsQ0FJRCxDQUxELGlDQVQrQix5QkFnQi9CLE1BQU8sQ0FDTEQsSUFBSSxDQUFFLEdBREQsQ0FBUCxDQUdELENBbkJELEMseUJBcUJBNEIsTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQ2ZoQyxNQURlLENBRWZNLE9BRmUsQ0FHZkUsTUFIZSxDQUlmaUIsTUFKZSxDQUtmSSxVQUxlLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2FsZXNNb2RlbCA9IHJlcXVpcmUoJy4uL21vZGVscy9TYWxlc01vZGVsJyk7XG5jb25zdCBQcm9kdWN0c01vZGVsID0gcmVxdWlyZSgnLi4vbW9kZWxzL1Byb2R1Y3RzTW9kZWwnKTtcbmNvbnN0IHsgYWRkSW52ZW50b3J5IH0gPSByZXF1aXJlKCcuLi91dGlscy9hZGRJbnZlbnRvcnknKTtcbmNvbnN0IHsgdmFsaWRhdGVQcm9kdWN0IH0gPSByZXF1aXJlKCcuLi91dGlscy92YWxpZGF0ZVByb2R1Y3QnKTtcbmNvbnN0IHsgdXBkYXRlSW52ZW50b3J5IH0gPSByZXF1aXJlKCcuLi91dGlscy91cGRhdGVJbnZlbnRvcnknKTtcblxuY29uc3QgZ2V0QWxsID0gYXN5bmMgKCkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCBTYWxlc01vZGVsLmdldEFsbCgpO1xuXG4gIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvZGU6IDQwNCxcbiAgICAgIG1lc3NhZ2U6ICdTYWxlcyBub3QgZm91bmQnLFxuICAgIH07XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGNvZGU6IDIwMCxcbiAgICBkYXRhOiByZXN1bHQsXG4gIH07XG59O1xuXG5jb25zdCBnZXRCeUlkID0gYXN5bmMgKGlkKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFNhbGVzTW9kZWwuZ2V0QnlJZChpZCk7XG5cbiAgaWYgKHJlc3VsdC5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4ge1xuICAgICAgY29kZTogNDA0LFxuICAgICAgbWVzc2FnZTogJ1NhbGUgbm90IGZvdW5kJyxcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBjb2RlOiAyMDAsXG4gICAgZGF0YTogcmVzdWx0LFxuICB9O1xufTtcblxuY29uc3QgY3JlYXRlID0gYXN5bmMgKHNhbGVzKSA9PiB7XG4gIC8qIFxuICAgIFZhbGlkYXRlIGlmIHRoZSBwcm9kdWN0cyBpbiB0aGUgXCJzYWxlc1wiIGFycmF5IGV4aXN0c1xuICAgIGFuZCBpZiB0aGUgaW52ZW50b3J5IHF1YW50aXR5IHN1YnRyYWN0ZWN0ZWQgc2FsZSBxdWFudGl0eSBpcyBncmVhdGVyIHRoYW4gMFxuICAqL1xuICBjb25zdCB7IHByb2R1Y3RFcnJvciwgcXVhbnRpdHlFcnJvciwgcHJvZHVjdHMgfSA9IGF3YWl0IHZhbGlkYXRlUHJvZHVjdChzYWxlcyk7XG5cbiAgaWYgKHByb2R1Y3RFcnJvci5tZXNzYWdlIHx8IHF1YW50aXR5RXJyb3IubWVzc2FnZSkge1xuICAgIHJldHVybiBxdWFudGl0eUVycm9yLm1lc3NhZ2UgPyBxdWFudGl0eUVycm9yIDogcHJvZHVjdEVycm9yO1xuICB9XG5cbiAgY29uc3Qgc2FsZUlkID0gYXdhaXQgU2FsZXNNb2RlbC5jcmVhdGVTYWxlKCk7XG5cbiAgYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgc2FsZXMubWFwKGFzeW5jICh7IHByb2R1Y3RJZCwgcXVhbnRpdHkgfSwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IG5ld1F1YW50aXR5ID0gcHJvZHVjdHNbaW5kZXhdLnF1YW50aXR5IC0gcXVhbnRpdHk7XG5cbiAgICAgIGF3YWl0IFByb2R1Y3RzTW9kZWwudXBkYXRlUXVhbnRpdHkoeyBwcm9kdWN0SWQsIHF1YW50aXR5OiBuZXdRdWFudGl0eSB9KTtcbiAgICAgIGF3YWl0IFNhbGVzTW9kZWwuY3JlYXRlU2FsZXNQcm9kdWN0cyh7IHNhbGVJZCwgcHJvZHVjdElkLCBxdWFudGl0eSB9KTtcbiAgICB9KSxcbiAgKTtcblxuICByZXR1cm4geyBjb2RlOiAyMDEsIGRhdGE6IHsgaWQ6IHNhbGVJZCwgaXRlbXNTb2xkOiBzYWxlcyB9IH07XG59O1xuXG5jb25zdCB1cGRhdGUgPSBhc3luYyAoeyBpZCwgcHJvZHVjdElkLCBxdWFudGl0eSB9KSA9PiB7XG4gIGNvbnN0IHNhbGVzID0gYXdhaXQgU2FsZXNNb2RlbC5nZXRCeUlkQW5kUHJvZHVjdElkKHsgaWQsIHByb2R1Y3RJZCB9KTtcblxuICBpZiAoIXNhbGVzKSByZXR1cm4geyBjb2RlOiA0MDQsIG1lc3NhZ2U6ICdTYWxlIG5vdCBmb3VuZCcgfTtcblxuICBjb25zdCB1cGRhdGVSZXN1bHQgPSBhd2FpdCB1cGRhdGVJbnZlbnRvcnkoaWQsIHF1YW50aXR5LCBzYWxlcy5xdWFudGl0eSk7XG5cbiAgaWYgKHVwZGF0ZVJlc3VsdC5tZXNzYWdlKSByZXR1cm4geyBjb2RlOiB1cGRhdGVSZXN1bHQuY29kZSwgbWVzc2FnZTogdXBkYXRlUmVzdWx0Lm1lc3NhZ2UgfTtcblxuICBhd2FpdCBQcm9kdWN0c01vZGVsLnVwZGF0ZVF1YW50aXR5KHsgcHJvZHVjdElkLCBxdWFudGl0eTogdXBkYXRlUmVzdWx0Lm5ld1F1YW50aXR5IH0pO1xuXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFNhbGVzTW9kZWwudXBkYXRlKHsgaWQsIHByb2R1Y3RJZCwgcXVhbnRpdHkgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBjb2RlOiAyMDAsXG4gICAgZGF0YToge1xuICAgICAgc2FsZUlkOiBpZCxcbiAgICAgIGl0ZW1VcGRhdGVkOiBbcmVzdWx0XSxcbiAgICB9LFxuICB9O1xufTtcblxuY29uc3QgZGVsZXRlU2FsZSA9IGFzeW5jIChpZCkgPT4ge1xuICBjb25zdCBnZXRTYWxlc0J5SWQgPSBhd2FpdCBnZXRCeUlkKGlkKTtcblxuICBpZiAoZ2V0U2FsZXNCeUlkLm1lc3NhZ2UpIHJldHVybiBnZXRTYWxlc0J5SWQ7XG5cbiAgYXdhaXQgYWRkSW52ZW50b3J5KGdldFNhbGVzQnlJZC5kYXRhKTtcblxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBTYWxlc01vZGVsLmRlbGV0ZVNhbGUoaWQpO1xuXG4gIGlmICghcmVzdWx0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvZGU6IDQwNCxcbiAgICAgIG1lc3NhZ2U6ICdTYWxlIG5vdCBmb3VuZCcsXG4gICAgfTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgY29kZTogMjA0LFxuICB9O1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGdldEFsbCxcbiAgZ2V0QnlJZCxcbiAgY3JlYXRlLFxuICB1cGRhdGUsXG4gIGRlbGV0ZVNhbGUsXG59OyJdfQ==